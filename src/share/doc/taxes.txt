Some enhancements to the tax configuration were made in LiteCommerce taking into account our client's needs. You can define taxes depending on customer's location, product class (e.g. define 'Tax free' products), customer's membership level (e.g. Wholesale), payment method, and even ordered products' attributes.

You can combine several conditions, like 'A tax for California for Food and Prescription Drugs is 0 (zero)', define separate taxes for shipping cost (actually, shipping is a special product class called 'shipping service').

For those who is looking an easy way to setup theirs taxes, there are some pre-defined tax schemas, currently 'One global tax value', 'US state sales tax rates', 'VAT system', and 'Canadian GST/PST system'. You can see them at the bottom of your 'Taxes' page in Admin zone.

The taxes schema is organized in the tree, where each node represents some condition (e.g. 'country=United States') which applies to all its underlying nodes. Leaf nodes are tax values in form of 'Tax-name'='Tax-value' (don't forget there can be several taxes).

  Creating conditional taxes.

You can see what conditional taxes are by selecting a 'One global tax value' scheme from the 'Predefined Tax Schemes' dialog. It consists of the following three rows (tax values are assigned for examle):

      Condition                            Tax    %
	------------------------------------------------
	                                       Tax    10
	product class=shipping service         Tax    5
	product class=Tax free                 Tax    0

  The first row specifies an unconditional tax (the Condition is empty), which is 10% in this scheme. The second row specifies a tax for shipping cost, which is 5% here. The third row specifies tax for 'Tax free' products (you can change the tax class on the product modification page). The table above is evaluated for each order item, considering the Shipping Cost as a separate (invisible) item. Thus the tax table can be read as following: 

  The only global tax is 10% for all products;
  If this is a shipping service assign 5% tax on the shipping cost.
  If this is a 'Tax free' products the tax is 0%; 

  To add a new conditional tax, click 'Add rate/condition', fill in the condition. You can specify taxes by customer location, payment method, product class (there can be several tax classes like 'tax exempt', '5% VAT' and so on), user membership level (you can asign different taxes for wholesales). In the 'Tax name' field select 'Tax' (which is a tax value added to your order total), enter the tav percent in the 'Tax value' field, click 'Add'.
  Note that more common conditions must be placed before more specific ones. E.g. the global tax value (10%) is placed before the tax free (0%), otherwise it whould replace the earlier definition of the 'Tax free', and your tax free products will be charged 10% tax. You can change the order of tax rows by adjusting the 'Pos' column values.
  
  Combining conditions.

  As you may have already noticed, there is an ability to define more than one condition fields in the 'Add Rate/Condition' dialog. This is used to create a complex conditions like 'If a customer comes from Florida AND it is buying Food,Prescription Drugs or Non-prescription Drugs, the tax is 0%'. To create such rule in LiteCommerce, follow the instructions below:
    1. Click Add rate/condition
	2. Type 'United States' in the Coutries box or select it in the select box next to the input box;
	3. Type 'Florida' in the Stated box or select it in the select box;
	4. Enumerate product classes in the 'Product class' box: 'Food,Non-prescription Drugs,Prescription Drugs'. Separate them by comma, do not insert spaces after or before comma. You can either select an existing product class from the select box or type in a new one;
	5. Select 'Tax' in the 'Tax name' field;
	6. type '0' in the 'Tax value'. Do not type '%' or '$'.
	7. Click 'Add'.

  After that, you will see the following line in the tax table:

          Condition                                           Tax     %
	---------------------------------------------------------------------
	country=United States AND state=Florida AND               Tax     0
	product class=Food,Non-prescription Drugs,
	Prescription Drugs

  You can group tax rates by a condition. For example, if you create several rules for customers coming from Florida, it is not neccessary to include 'country=United States AND state=Florida' in each rule. Instead, you can create a condition 'country=United States AND state=Florida' and nest rules into that condition. This is folder/subfolder/file paradigm, just like in the Microsoft Windows Explorer. Files and subfolders of a folder are displayed indended in the tax rates. Gray rows designate folders. The 'US states sales tax rates' predefined scheme is a good illustration of nested conditions. You can open or close folders by clicking the plus or minus box.
  To create a folder, do not enter anything in the 'Tax name' and 'Tax value' fields in the Add rate/condition' dialog. Only define a condition. To create a subfolder, click 'Add rate/condition here' next to the parent folder.

  Creating more then one taxes.

You can define several taxes in LiteCommerce. It is typical that the tax consists of parts, e.g. in US the 'Total tax' is a sum of the 'State tax' and the 'City tax'. You can assign a formula to the tax value instead of its value by putting '=' in front of it. This is an example of simple State/city tax scheme:

	1. Click 'Add rate/condition;
	2. Type 'Tax' in the 'Tax name' field. This is a special tax name used to calculate order total;
	3. Type '=State tax + City tax' in the 'Tax value' field;
	4. Click 'Add';

  Now we have to define 'State tax' and 'City tax' names before we can use our taxes calculator. Let's define taxes for some states and, say, 6% for others, and 'City tax' to be, say, 1.5%. This won't be a precise scheme, however it whould give you a common idea of how to create tax schemes.
  You may want to define conditional taxes corresponding to each state and than define a tax for others states. The problem is that there is no condition 'Others'. You must understand how tax rates are found in the table: each table row is matched against each order item, and if it matches (remember that unconditional taxes matches always), it overrides the previous tax value and continue searching. For example, this is wrong:
  
        Condition                                   Tax         %     Pos.
	-----------------------------------------------------------------------
	state=California                            State tax      7.25    10
	state=Georgia,Hawaii                        State tax       4      20
	state=Illinois                              State tax      6.25    30
                                                State tax       6      40

  because the unconditional tax 'State tax' (6%) at the last row will override values matched before. You should always put 'Others' condition in front of other conditions. You can change the order of rows: change 'Pos.' value from 40 to, say, 5 and click 'Update'. This will move it to the first row.
  The following is a correct scheme for the given case. Note that the rules are nested into the 'country=United States' folder and are therefore indented, and the tax value outside this folder is 0% (other countries). 

        Condition                               Tax         %     
	-------------------------------------------------------------
	                                        Tax             0
	[-] country=United States
	                                        Tax         =State tax + City tax
                                            City tax       1.5
                                            State tax       6
		state=California                    State tax      7.25
		state=Georgia,Hawaii                State tax       4
		state=Illinois                      State tax      6.25

  In this schemem, the tax is charged on shipping cost as well as on order items. To get rid of the shipping tax, create a conditional tax with product class=shipping service and zero value.
 
  Displaying several taxes in cart totals and invoice.

  You may want to show detailed taxes to your customers. Only total tax value is shown by default. You can change it in the 'Options' panel of the 'Taxes' dialog. Add taxes you want to show in your cart and invoice to the 'Which taxes to display:' table. You can see an example in the 'Canadian GST/PST system' scheme. It displays three taxes: GST, HST and PST. Note that the HST is not defined for some provinces, therefore it is not shown.

