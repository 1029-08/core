From ef1c2a58c2d055d9d0845f5bb109ce8a5d0b58ee Mon Sep 17 00:00:00 2001
From: Juozas Kaziukenas <juozas@juokaz.com>
Date: Tue, 8 Jun 2010 00:43:13 +0100
Subject: [PATCH] Fixed identifiers quoting

---
 lib/Doctrine/DBAL/Platforms/MsSqlPlatform.php |   26 +++++++++++++++++++++++++
 1 files changed, 26 insertions(+), 0 deletions(-)

diff --git a/lib/Doctrine/DBAL/Platforms/MsSqlPlatform.php b/lib/Doctrine/DBAL/Platforms/MsSqlPlatform.php
index 8404ff5..459fb70 100644
--- a/lib/Doctrine/DBAL/Platforms/MsSqlPlatform.php
+++ b/lib/Doctrine/DBAL/Platforms/MsSqlPlatform.php
@@ -98,6 +98,32 @@ class MsSqlPlatform extends AbstractPlatform
     /**
      * @override
      */
+    public function getColumnDeclarationSQL($name, array $field)
+    {
+        $declaration = parent::getColumnDeclarationSQL($name, $field);
+
+        $name = substr($declaration, 0, strpos($declaration, ' '));
+        $spec = substr($declaration, strpos($declaration, ' ')+1);
+
+        if (strpos($name, '[') === false)
+        {
+            $name = $this->quoteIdentifier($name);
+        }
+
+        return $name . ' ' . $spec;
+    }
+
+    /**
+     * @override
+     */
+    public function quoteIdentifier($str)
+    {
+        return '[' . $str . ']';
+    }
+
+    /**
+     * @override
+     */
     public function getDropForeignKeySQL($foreignKey, $table)
     {
         if ($foreignKey instanceof \Doctrine\DBAL\Schema\ForeignKeyConstraint) {
-- 
1.6.5.1.1367.gcd48

